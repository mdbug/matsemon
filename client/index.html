<!-- IMMER AUSGIEBIG KOMMENTIEREN! :-) -->
<!DOCTYPE html>
<html>
<head>

	<link rel="stylesheet" href="/client/bootstrap.min.css">
	<!--<link rel="stylesheet" href="/client/bootstrap-theme.min.css">-->
	<script src="/client/jquery-3.2.1.min.js"></script>
	<script src="/client/bootstrap.min.js"></script>
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<rel src="style.css" type="text/css">
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	<title>MA-TSE-MON! - the beginning</title>
	
	<style>
	@font-face {
		font-family: matsemonHeaderFont;
		src: url("/client/endor.ttf") format("truetype");
	}
	@font-face {
		font-family: matsemonFont;
		src: url("/client/vtksdura.ttf") format("truetype");
	}
	#headerDiv, #opponentDiv, #chooseDiv, #fightDiv, #signDiv{
		font-family: ;
	}
	h1{
		font-family: matsemonHeaderFont;
	}
	html,body{
		background-image: url('/client/img/spring.png');
		background-size: cover;
		background-position: center top;
		background-attachment: fixed;
		background-repeat: no repeat;
	}
	.possibleOpponent{
		cursor: url('/client/img/sword7.png'), auto;
		background-color: rgba(255,255,255,0.7);
	}
	.form-control{
		border-radius:0px;
	}
	.btn{
		border-radius:0px;
		border:;
		width:10em;
	}
	.possibleOpponent{
		text-align:center;
	}
	#chatDivFormInput{
		color:white;
		background-color:#424242;
		border:0px solid #282828;
	}
	#chatDivFormInput:focus{
		outline:none;
		border:0px;
		background-color:#494949;
	}
	</style>
</head>
<body>
<div class="row">
	<div id="containerDiv" class="container col-xs-12 col-md-8 col-md-offset-2 "><!-- HTML-STRUKTUR-->
		
		<div id="headerDiv" style="" class="col-xs-12 ">
			<div class="row">
				<h1 class="col-xs-8 text-center" style="text-align:center;">MA-TSE-MON!</h1>
				<div class="dropdown col-xs-4">
				<button style="background-color:rgba(0,0,0,0);border:0px;" class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Menu
					<!--<span class="caret"></span>-->
				  </button>
				  <ul class="dropdown-menu" aria-labelledby="dropdownMenu">
					<li><a href="#">Skills</a></li>
					<li><a href="#">Best list</a></li>
					<li role="separator" class="divider"></li>
					<li><a href="#">Impressum</a></li>
					<li><a href="#">Project</a></li>
					<li><a href="#">Facebook</a></li>
				  </ul>
				</div>
			</div>
		</div>
		<!-- AUDIO -->
		<audio id="audio1" autoplay="true" controls="true" hidden loop src="http://horde.sytes.net/matsemon/client/sound/edelwei.wav">
		</audio>
		<audio id="audio2" controls hidden src="http://horde.sytes.net/matsemon/client/sound/death.wav">
		</audio>
		<audio id="audio3" controls hidden src="http://horde.sytes.net/matsemon/client/sound/start.wav">
		</audio>
		<audio id="audio4" controls hidden src="http://horde.sytes.net/matsemon/client/sound/goal.wav">
		</audio>
		<audio id="audio5" controls hidden loop src="http://horde.sytes.net/matsemon/client/sound/slapayda-sunset-by-schabau.wav">
		</audio>
		<audio id="audio6" controls hidden src="http://www.downloadfreesound.com/wp-content/uploads/2013/08/Beep8.wav">
		</audio>
		<!-- SIGN -->
		<div id="signDiv" class="col-xs-12" style="">
			<div  class="form-group">
				<label for="signDivUsername">Username</label>
				<input class="form-control" id="signDivUsername" name="signDivUsername" type="text" autofocus></input><br/>
			</div>
			<div class="form-group">
				<label for="signDivPassword">Password</label>
				<input class="form-control" id="signDivPassword" name="signDivPassword" type="password"></input>
			</div>
			<div class="form-group text-center">
				<button id="signDivSignIn" type="button" class="btn btn-primary btn-sm">Sign In</button>
				<button id="signDivSignUp" type="button" class="btn btn-primary btn-sm">Sign Up</button>
			</div>
		</div>
		<!-- FIGHT -->
		<div id="fightDiv" class="col-xs-12" style="display:none;float:left;">
			<canvas id="fightDivAnimations" height="200px" width="500px" style="border:0px solid red">MONSTER FIGHT IN HERE</canvas>
			<div class="row" id="">		
				<div class="progress col-xs-6" style="background-color:rgba(0,0,0,0);">
					<div style="background-color:red;color:black;border:1px solid black" id="fightDivMyHp" class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%"></div>
				</div>	
				<div class="progress col-xs-6" style="background-color:rgba(0,0,0,0);">
					<div style="background-color:red;color:black;border:1px solid black" id="fightDivEnemyHp" class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%"></div>
				</div>
			</div>
			<div class="text-center" id="fightDivAttacks" style="border:0px solid red">
				<button id="fightDivAttacksButton1" type="button" class="btn btn-default btn-sm col-xs-3">Feuerodem</button>
				<button id="fightDivAttacksButton2" type="button" class="btn btn-default btn-sm col-xs-3">Drachenatem</button>
				<button id="fightDivAttacksButton3" type="button" class="btn btn-default btn-sm col-xs-3">Schattenfluch</button>
				<button id="fightDivAttacksButton4" type="button" class="btn btn-default btn-sm col-xs-3">Aufgeben</button>
			</div>
			<div id="fightDivInfo" style="float:left;border:1px dashed black;display:none">
				<div>my name:<p id="fightDivInfoMyUsername"></p></div>
				<div>enemy name:<p id="fightDivInfoEnemyUsername"></p></div>
				<div>my guild:<p id="fightDivInfoMyGuild"></p></div>
				<div>enemy guild:<p id="fightDivInfoEnemyGuild"></p></div>
				<div>my lvl:<p id="fightDivInfoMyLvl"></p></div>
				<div>enemy lvl:<p id="fightDivInfoEnemyLvl"></p></div>
				<div>my hp:<p id="fightDivInfoMyHp"></p></div>
				<div>enemy hp:<p id="fightDivInfoEnemyHp"></p></div>
				<div>fight id:<p id="fightDivInfoFightId"></p></div>
				<div>turn:<p id="fightDivInfoTurn"></p></div>
			</div>
		</div>

		<!-- BEST -->
		<div id="bestDiv" class="col-xs-12" style="display:none;border:0px solid indianred">
		</div>
		<!-- OPPONENT -->
		<div id="opponentDiv" class="col-xs-12" style="border:0px solid blue;display:none;">
		<h3>Click on these players to send them a challenge!</h3>
			<div id="opponentDivList" style="border:0px solid blue">
				<!-- players you can attack in here -->
			</div>
		</div>
		<!-- CONFIRMBOX -->
		<div id="chooseDiv" class="col-xs-12" style="display:none;border: 0px solid pink;">
			<h3 id="chooseDivConfirm">Accept?</h3>
			<div class="form-group text-center">
				<button id="chooseDivConfirmYes" type="button" class="btn btn-default btn-sm">yes</button>
				<button id="chooseDivConfirmNo" type="button" class="btn btn-default btn-sm">no</button>
			</div>
		</div>
		<div id="infoMessageDiv" class="col-xs-12"></div>
		<!-- CHAT -->
		<div id="chatDiv" class="col-xs-12" style="border:0px solid black;display:none">
			<div class="">
				<div id="chatDivText" style="height:100px;overflow-y:scroll;background:#282828;border:0px solid black;">
					<!-- chat in here -->
				</div>
			</div>
			<form class="" id="chatDivForm" style="">
				<input type="text" id="chatDivFormInput" class="col-xs-12" style=""></input>
			</form>
			<div style="border:1px solid black">
				<div class="col-xs-12" id="expBar" style="padding:0;margin:0;background-color:orange;height:6px;width:1%;display:inline-block;"></div>
			</div>
			<div class="" style="background-color:white;font-size:0.7em">
				<div class="col-xs-1" id="chatDivInfoLvl"></div>
				<div class="col-xs-1" id="chatDivInfoExp"></div>
				<div class="col-xs-4" id="chatDivInfoGuild"></div>
				<div style="display:none" class="col-xs-1" id="chatDivInfoGuildmaster"></div>
				<div style="display:none" class="col-xs-1" id="chatDivInfoInfight"></div>
				<div class="col-xs-4" id="chatDivInfoUsername"></div>
			</div>
		</div>
	</div><!-- END OF #containerDiv -->
</div><!-- END OF .row -->
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	var socket = io();
	/**************************************** VARIABLES BEGIN ***************************************************/
	/* DOM-ELEMENTS BY ID */
	/* NAMEN ENTSPRECHEN EXAKT IHRER ID! BITTE SO BEIBEHALTEN! */
	var containerDiv = document.getElementById('containerDiv');
	/* DEN DOM-ELEMENTEN KANN PER VARIABLEN-NAME EIN EVENT HINZUGEFÜGT WERDEN ( xyzDiv-xyz-xyz.onclick = function(){} ) */
	var headerDiv = document.getElementById('headerDiv');
	//var chatDivMyInfo = document.getElementById('chatDivMyInfo');
	var  chatDivInfoUsername = document.getElementById('chatDivInfoUsername');
	var  chatDivInfoLvl = document.getElementById('chatDivInfoLvl');
	var  chatDivInfoExp = document.getElementById('chatDivInfoExp');
	var  chatDivInfoGuild = document.getElementById('chatDivInfoGuild');
	var  chatDivInfoGuildmaster = document.getElementById('chatDivInfoGuildmaster');
	var  chatDivInfoInfight = document.getElementById('chatDivInfoInfight');
	//auskommentiert, weil server nicht online auf den die src-verweise hinführen.
	var audio1 = document.getElementById('audio1');
	var audio2 = document.getElementById('audio2');
	var audio3 = document.getElementById('audio3');
	var audio4 = document.getElementById('audio4');
	var audio5 = document.getElementById('audio5');
	var audio6 = document.getElementById('audio6');
	var signDiv = document.getElementById('signDiv');
	var signDivUsername = document.getElementById('signDivUsername');
	var signDivPassword = document.getElementById('signDivPassword');
	var signDivSignIn = document.getElementById('signDivSignIn');
	var signDivSignUp = document.getElementById('signDivSignUp');
	var chatDiv = document.getElementById('chatDiv');
	var chatDivText = document.getElementById('chatDivText');
	var chatDivForm = document.getElementById('chatDivForm');
	var chatDivFormInput = document.getElementById('chatDivFormInput');
	var bestDiv = document.getElementById('bestDiv');
	var opponentDiv = document.getElementById('opponentDiv');
	var opponentDivList = document.getElementById('opponentDivList');
	var chooseDiv = document.getElementById('chooseDiv');
	var chooseDivConfirm = document.getElementById('chooseDivConfirm');
	var chooseDivConfirmYes = document.getElementById('chooseDivConfirmYes');
	var chooseDivConfirmNo = document.getElementById('chooseDivConfirmNo');
	var fightDiv = document.getElementById('fightDiv');
	var fightDivAnimations = document.getElementById('fightDivAnimations');
	var fightDivMyHp = document.getElementById('fightDivMyHp');
	var fightDivEnemyHp = document.getElementById('fightDivEnemyHp');
	var fightDivAttacks = document.getElementById('fightDivAttacks');
	var fightDivAttacksButton1 = document.getElementById('fightDivAttacksButton1');
	var fightDivAttacksButton2 = document.getElementById('fightDivAttacksButton2');
	var fightDivAttacksButton3 = document.getElementById('fightDivAttacksButton3');
	var fightDivAttacksButton4 = document.getElementById('fightDivAttacksButton4');
	var fightDivInfo = document.getElementById('fightDivInfo');
	var fightDivInfoMyUsername = document.getElementById('fightDivInfoMyUsername');
	var fightDivInfoEnemyUsername = document.getElementById('fightDivInfoEnemyUsername');
	var fightDivInfoMyGuild = document.getElementById('fightDivInfoMyGuild');
	var fightDivInfoEnemyGuild = document.getElementById('fightDivInfoEnemyGuild');
	var fightDivInfoMyLvl = document.getElementById('fightDivInfoMyLvl');
	var fightDivInfoEnemyLvl = document.getElementById('fightDivInfoEnemyLvl');
	var fightDivInfoMyHp = document.getElementById('fightDivInfoMyHp');
	var fightDivInfoEnemyHp = document.getElementById('fightDivInfoEnemyHp');
	var fightDivInfoFightId = document.getElementById('fightDivInfoFightId');
	var fightDivInfoTurn = document.getElementById('fightDivInfoTurn');
	var infoMessageDiv = document.getElementById('infoMessageDiv');
	/* COLORS */
	var normalColor = 'white'; //normale Farbe zb für den "All-Chat" - weiß
	var whisperColor = '#f828fc'; //Flüster-Farbe - türkis
	var guildColor = '#30e52d'; //Gilden-Farbe - grün
	var infoColor = '#e5ff00'; //bei Informationen - gelb
	var warningColor = '#ffbf00'; //bei Warnungen - orange
	var errorColor = '#ff0000' //bei Fehlern - rot
	/* OTHER */
	var inChatInput = false; //Zum Herausfinden, ob der Spieler gerade etwas im Chat eintippt
	var loggedIn = false;
	var guildInvitation;
	/******************************************* VARIABLES END ************************************************/
	/******************************************* FUNCTIONS BEGIN ******************************************************/
	function addToChat(data, color){
		audio6.play();
		chatDivText.innerHTML += '<div style="color:'+color+'">' + data + '</div>';
		chatDivText.scrollTop = chatDivText.scrollHeight;
	}
	function addOnclickEvents(username){
		var possibleOpponents = document.getElementsByClassName('possibleOpponent');
		for(var key in possibleOpponents){
			possibleOpponents[key].onclick = function(){
				var opponentUsername = this.id;
				socket.emit('challenge', {opponentUsername:opponentUsername});
			}
		}
	}
	/******************************************** FUNCTIONS END ***************************************************/
	/******************************************** CLIENT-EVENTS BEGIN ***********************************************/
	signDivSignUp.onclick = function(){
		socket.emit('signUp', {username:signDivUsername.value, password:signDivPassword.value});
	}
	signDivSignIn.onclick = function(){
		socket.emit('signIn', {username:signDivUsername.value, password:signDivPassword.value});
	}
	chooseDivConfirmYes.onclick = function(){
		socket.emit('challengeChoice', {choice:true, challengerUsername:chooseDiv.name});
		chooseDiv.style.display = 'none'; //buttons nach entscheidung wieder ausblenden
	}
	chooseDivConfirmNo.onclick = function(){
		socket.emit('challengeChoice', {choice:false, challengerUsername:chooseDiv.name});
		chooseDiv.style.display = 'none'; //buttons nach entscheidung wieder ausblenden
	}	
	chatDivFormInput.onfocus = function(){
		inChatInput = true;
	}
	chatDivFormInput.onblur = function(){
		inChatInput = false;
	}
	chatDivForm.onsubmit = function(e){
console.log('chatinputonsubmit: '+chatDivFormInput.value);
		e.preventDefault(); //no refresh of page will be happen
		if(chatDivFormInput.value !== ''){
			if(chatDivFormInput.value === '/help'){
				addToChat('Whisper: <code>/w [playername] [message]</code>, best list: <code>/best</code>, guild creation: <code>/gcreate [guildname]</code>, guild invite: <code>/ginvite [player name]</code>, guild leave: <code>/gleave</code>, guild kick: <code>/gkick [player name]</code>, guild delete: <code>/gdelete</code>				',infoColor);
			} else if(chatDivFormInput.value === '/best'){
				//window.open('client/best.html','_blank');
				socket.emit('getBestData',{});
				if(bestDiv.style.display == 'inline-block'){
					bestDiv.style.display = 'none'
				} else {
					bestDiv.style.display = 'inline-block';
				}
			} else if((chatDivFormInput.value[0] === '/' && chatDivFormInput.value[1] === 'w' && chatDivFormInput.value[2] === ' ' && chatDivFormInput.value[3] != undefined) ||chatDivFormInput.value.substring(0,3) === '/W '){ //WHISPER!
				var len = 0;
				for(var el in chatDivFormInput.value.split(" ")){
					len++;
				}
				if(len>=3){
					//"/w sth msg" should only contain /w AND to AND msg -> array of at least 3 elements
					var split = chatDivFormInput.value.split(" ");
					var msg = '';
					for(var i = 2; i < split.length; i++){
						msg+=split[i]+" ";
					}
					socket.emit('sendWspToServer', {message:msg,to:split[1]});
				} else {
					addToChat('Du musst eine Nachricht angeben, wenn du versuchst etwas zu flüstern! :o', warningColor);
				}
			} else if(chatDivFormInput.value.substring(0,9) === '/gcreate '){
				if(true){
					var split = chatDivFormInput.value.split(' ');
					var guildname = '';
					for(var i = 1; i < split.length; i++){
						guildname+=split[i]+" ";
					}
					guildname = guildname.substring(0,guildname.length);
					if(guildname.length >= 1){
						if(guildname.length <= 16){
							socket.emit('guildCreate', {guildname:guildname});
						} else {
							addToChat('The guild name can contain a maximum of 16 characters!', warningColor);
						}
					} else {
						addToChat('The guild name must have at least one character!', warningColor);
					}
				}
			} else if (chatDivFormInput.value.substring(0,8) === '/gdelete'){
				socket.emit('guildDelete', {});
			} else if (chatDivFormInput.value.substring(0,9) === '/ginvite '){
				var split = chatDivFormInput.value.split(' ');
				socket.emit('guildInvite', {username:split[1]});
			} else if (chatDivFormInput.value.substring(0,7) === '/gleave'){
				socket.emit('guildLeave', {}); 
			} else if(chatDivFormInput.value.substring(0,7) === '/gkick ' ){
				var split = chatDivFormInput.value.split(' ');
				socket.emit('guildKick', {username: split[1]});
			} else if (chatDivFormInput.value.substring(0,4) === '/yes'){
				if (guildInvitation != undefined){
console.log('/yes wurde geklickt. guildInvitation ist gerade: '+guildInvitation);
					socket.emit('guildJoin', {guildname:guildInvitation});
					guildInvitation = undefined;
				}
			} else if (chatDivFormInput.value.substring(0,3) === '/no'){	
				guildInvitation = undefined;
			} else if (chatDivFormInput.value.substring(0,3) === '/g ' ||chatDivFormInput.value.substring(0,3) === '/G '){
				var split = chatDivFormInput.value.split(' ');
				var message = '';
				for(var i = 1; i < split.length; i++){
					message+=split[i]+" ";
				}
				
console.log('message is now (/g):'+message);
				socket.emit('guildMessage', {message:message});
			} else if(chatDivFormInput.value[0] === '/' && chatDivFormInput.value[1] !== 'w'){ //beim eval darf kein w am anfang stehen.....
				socket.emit('evalServer', chatDivFormInput.value.slice(1)); //EVAL
			} else {
				socket.emit('sendMsgToServer', chatDivFormInput.value);//EVERYONE
			}
			chatDivFormInput.value = '';
		}
	}
	document.onkeyup = function(event){ //KEYBOARD EVENTS
		if(!inChatInput){ //Falls der Spieler gerade nichts im Chat eingibt, zählen die Tasten 1-4 als Attackversuche und Enter als signIn-Versuch
			if(event.keyCode === 49 ){ //1
				socket.emit('atk1',{});
				fightDivAttacks.style.visibility = 'hidden'; 
			} else if(event.keyCode === 50){ //2
				socket.emit('atk2',{});
				fightDivAttacks.style.visibility = 'hidden'; 
			} else if(event.keyCode === 51){ //3
				socket.emit('atk3',{});
				fightDivAttacks.style.visibility = 'hidden'; 
			} else if(event.keyCode === 52){ //4
				socket.emit('giveUp', {fightId:fightDivInfoFightId.innerHTML, enemyUsername:fightDivInfoEnemyUsername.innerHTML});
				fightDivAttacks.style.visibility = 'hidden'; 
			} else if(event.keyCode === 13 && !loggedIn){ //Enter
				socket.emit('signIn', {username:signDivUsername.value, password:signDivPassword.value});
			}
		}
	}
	fightDivAttacksButton1.onclick = function(){
		socket.emit('atk1', {});
		//fightDivAttacks ausblenden
		fightDivAttacks.style.visibility = 'hidden'; 
	}
	fightDivAttacksButton2.onclick = function(){
		socket.emit('atk2', {});
		//fightDivAttacks ausblenden
		fightDivAttacks.style.visibility = 'hidden'; 
	}
	fightDivAttacksButton3.onclick = function(){
		socket.emit('atk3', {});
		//fightDivAttacks ausblenden
		fightDivAttacks.style.visibility = 'hidden'; 
	}
	//GIVE UP
	fightDivAttacksButton4.onclick = function(){
		socket.emit('giveUp', {fightId:fightDivInfoFightId.innerHTML, enemyUsername:fightDivInfoEnemyUsername.innerHTML});
	}
	/********************************************* CLIENT-EVENTS END ************************************************/
	/********************************************* SERVER-RESPONSE BEGIN ********************************************/
	//SIGN-UP-RESPONSE
	socket.on('signUpResponse', function(data){
		if(data.success){
			infoMessageDiv.innerHTML = 'Sign Up successful! :)';
		} else {
			infoMessageDiv.innerHTML = 'Sign Up unsuccessful! :(';
		}
	});
	//SIGN-IN-RESPONSE
	socket.on('signInResponse', function(data){
		if(data.success){
			loggedIn = true;
			audio1.pause();
			audio5.play();
			/* signDiv ausblenden, chatDiv und opponentDiv einblenden */
			signDiv.style.display = 'none';
			chatDiv.style.display = 'inline-block';
			opponentDiv.style.display = 'inline-block';
			addToChat('Willkommen zu MA-TSE-MON! - Das Abenteuer beginnt! Befehlsübersicht: <code>/help</code>', infoColor);
			infoMessageDiv.innerHTML = '';
		} else {
			infoMessageDiv.innerHTML = 'Sign In unsuccessful! ._.';
		}
	});
	//ALREADY LOGGED-IN
	socket.on('alreadyLoggedIn', function(){
		infoMessageDiv.innerHTML = 'Du bist bereits woanders eingeloggt! Bitte logge dich dort zuerst aus. ^o^';
	});
	//GET MY DATA
	socket.on('getMyData', function(data){ //data is JSON
		if(data.username){
			chatDivInfoUsername.innerHTML = data.username;
		}
		if(data.exp){
			chatDivInfoExp.innerHTML = 'exp:'+data.exp;
		}
		//chatDivInfoLvl.innerHTML = 'lvl:'+data.lvl;
		if(data.guild){
			chatDivInfoGuild.innerHTML = 'guild:'+data.guild;
		}
		if(data.guildmaster){
			chatDivInfoGuildmaster.innerHTML = 'guildmaster:'+data.guildmaster;
		}
		if(data.infight){
			chatDivInfoInfight.innerHTML = 'infight:'+data.infight;
		}
		//IDEE: für lvl n braucht man INSGESAMT n^2 exp 1:1,2:4,20:400,30:900,50:2500,100:10.000 !
		if(data.exp){
			playerlvl = 1;
			expprogress = data.exp*25;
			for(var i = 2; i <= 100; i++){
				if(data.exp >= Math.pow(i,2)){
					playerlvl = i;
					expprogress = (data.exp - Math.pow(i,2))/Math.pow(i,2)*100;
				}
			}
			document.getElementById('expBar').style.width = expprogress+'%';
			if(parseInt(chatDivInfoLvl.innerHTML) < playerlvl){
				addToChat('Level up! (You gain 1 skill point)', infoColor);
			}
			chatDivInfoLvl.innerHTML = 'lvl:'+playerlvl;
		}
	});
	
	//ADD TO CHAT
	socket.on('addToChat', function(data){
		if(data.color === 'info'){
			addToChat(data.message, infoColor);
		} else if(data.color === 'guild'){
			addToChat(data.message, guildColor);
		} else if(data.color === 'warning'){
			addToChat(data.message, warningColor);
		} else if(data.color === 'error'){
			addToChat(data.message, errorColor);
		} else {
			addToChat(data.message, normalColor);
		}
	});
	socket.on('addToInfoBox', function(data){
		infoMessageDiv.innerHTML = data.message;
	});
	//DEBUG (EVAL)
	socket.on('evalAnswer', function(data){
		console.log(data);
	});
	//WHISPER FAILURE
	socket.on('whisperFail', function(data){
		if(data.stupid){
			addToChat('Warum flüsterst du dir selbst? O_O', warningColor);
		} else {
			addToChat(data.to+' ist nicht online oder existiert nicht. :(', warningColor);
		}
	});
	//WHISPER FROM ME
	socket.on('whisperFromMe', function(data){
		addToChat(data.message, whisperColor);
	});
	//WHISPER FOR ME
	socket.on('whisperForMe', function(data){
		addToChat(data.message, whisperColor);
	});
	//GUILD INVITE
	socket.on('guildInvite', function(data){
		addToChat('You have been invited to join the guild '+data.guildname+'!', infoColor);
		//addToChat('Du wirst testhalber automatisiert dort aufgenommen - du hast leider keine Wahl.', infoColor);
		addToChat('Type <code>/yes</code> or <code>/no</code> in the chat!', infoColor);
		guildInvitation = data.guildname;
	});
	
	//OPPONENT INIT - INITIALISIERT OPPONENT-LIST
	socket.on('opponentInit', function(data){ //data is JSON
		if(data.clear){
		opponentDivList.innerHTML = '';
		}
		try{
			var sth = document.getElementById(data.username).style.color;
		}catch(err){
			opponentDivList.innerHTML += '<div id="'+data.username+'" class="possibleOpponent" style="border:1px dashed black;margin:0px;padding:0px">'+data.username+'</div><br/>';
			addOnclickEvents(data.username); //onclick event hinzufuegen
		}
	});
	//READY - WIRD ZUR OPPONENT-LIST HINZUGEFÜGT
	socket.on('ready', function(data){ //data is JSON
		try{
			var sth = document.getElementById(data.username).style.color;
		}catch(err){
			opponentDivList.innerHTML += '<div id="'+data.username+'" class="possibleOpponent" style="border:1px dashed black;margin:0px;padding:0px">'+data.username+'</div><br/>';
			addOnclickEvents(data.username); //onclick event hinzufuegen
		}
	});


	//BUSY - WIRD VON DER OPPONENT-LIST ENTFERNT
	socket.on('busy', function(data){ //data is JSON
		var elem = document.getElementById(data.username);
		if(elem != undefined){
			elem.parentNode.removeChild(elem); //hier wird ein error geschmissen wenn jemand disconnected, der nicht auf der opponent list sichtbar war - soweit bekannt, sollte vorerst kein problem darstellen, evtl try & catch?
		}
		//elem.style.display = 'none';
	});
						
	//GET CHALLENGED BY SOMEBODY
	socket.on('challenged', function(data){
		chooseDiv.style.display = 'inline-block';
		chooseDivConfirm.innerHTML = data.challengerUsername + ' asked you for a challenge - Will you agree?';
		chooseDiv.name = data.challengerUsername; //Der Name vom Herausforderer muss irgendwie gespeichert werden - Dieser Weg ist aber durchaus merkwürdig :D
console.log('chooseDiv.name is now '+chooseDiv.name); //Nur zum debuggen
	});
	//CHALLENGE-ANSWER - YOUR OPPONENT CHOSE YES OR NO
	socket.on('challengeAnswer', function(data){
		if(data.success){
console.log(data.opponentUsername+' agreed your challenge!'); //Nur zum debuggen
			//fightDiv einblenden, opponentDiv ausblenden
			fightDiv.style.display = 'inline-block';
			opponentDiv.style.display = 'none';
			infoMessageDiv.innerHTML = '';
		} else {
			infoMessageDiv.innerHTML = data.opponentUsername+' declined your challenge!';
		}
	});
	
	//FIGHT INIT - ALLE DATEN WERDEN ERST EINMAL INITIALISIERT
	socket.on('beginFight', function(data){
		fightDivAttacksButton1.innerHTML = data.atk1;
		fightDivAttacksButton2.innerHTML = data.atk2;
		fightDivAttacksButton3.innerHTML = data.atk3;
		
		fightDivMyHp.innerHTML = data.myUsername;
		fightDivEnemyHp.innerHTML = data.enemyUsername;
		
		addToChat('Fight starts!', infoColor);
		fightDivInfoMyUsername.innerHTML = data.myUsername;
		fightDivInfoEnemyUsername.innerHTML = data.enemyUsername;
		fightDivInfoMyGuild.innerHTML = data.myGuild;
		fightDivInfoEnemyGuild.innerHTML = data.enemyGuild;
		fightDivInfoMyLvl.innerHTML = data.myLvl;
		fightDivInfoEnemyLvl.innerHTML = data.enemyLvl;
console.log('das ist das fight init - enemy lvl '+data.enemeyLvl);
		fightDivInfoMyHp.innerHTML = 100;
		fightDivMyHp.style.width = '100%';
		fightDivInfoEnemyHp.innerHTML = 100;
		fightDivEnemyHp.style.width = '100%';
		fightDivInfoFightId.innerHTML =  data.fightId;
		fightDivInfoTurn.innerHTML = data.turn;
		//oponentDiv ausblenden und fightDiv einblenden und fightDivAttacks ausblenden, falls nicht am Zug
		opponentDiv.style.display = 'none';
		fightDiv.style.display = 'inline-block';
		if(data.turn != data.myUsername){
			fightDivAttacks.style.visibility = 'hidden';
		} else {
			fightDivAttacks.style.visibility = 'visible';
		}
	});
	//END FIGHT
	socket.on('endFight', function(data){
		addToChat('Fight is over', infoColor);

		//opponentDiv wird eingeblendet und fightDiv wird ausgeblendet
		opponentDiv.style.display = 'inline-block';
		fightDiv.style.display = 'none';
	});
	
	//ME TOOK DAMAGE
	socket.on('takeDmg', function(data){
		if(data.myturn){
			fightDivAttacks.style.visibility = 'visible'; //Hier wird nicht die Technik von display:none/inline-block verwendet damit sich nicht alles verschiebt während des Zugwechsels!
		}
		fightDivMyHp.style.width = data.newHp+'%';
		
	});
	//ENEMY TOOK DAMAGE
	socket.on('yourEnemyTookDmg', function(data){
		if(data.myturn){
			fightDivAttacks.style.visibility = 'visible'; //Hier wird nicht die Technik von display:none/inline-block verwendet damit sich nicht alles verschiebt während des Zugwechsels!
		}
		fightDivEnemyHp.style.width = data.newHp+'%';
	});
	//ATTACK HANDLING - DAMAGE
	socket.on('atkResponse', function(data){
		if(data.success){
			socket.emit('dealDamage', {enemy:enemyUsername,fightId:id});
			myTurn = false;
			myTurn.innerHTML = myTurn;
			infoMessageDiv.innerHTML = '';
		} else {
			infoMessageDiv.innerHTML = 'Server denied your attack! o~o';
		}
	});
	//BEST
	socket.on('sendBestData', function(res){
		bestDiv.innerHTML = '';
		cnt = 1;
		for(var key in res){
			bestDiv.innerHTML += cnt+'. with lvl '+res[key].lvl+' is '+res[key].username+'<br>';
			cnt++;
		}
		bestDiv.innerHTML += 'Hide this view: <code>/best</code>';
	});
	
//GET STATS (CONNECTED CLIENTS) - Nur zum debuggen
socket.on('stats', function(data){
console.log('Connected clients:' + data.numClients);
});
	
	/********************************************** SERVER-RESPONSE END **********************************************/
	/* ICH HABE ALLES AN CODE, DAS NUR ZUM DEBUGGEN VORHANDEN IST (DARUNTER GANZE EVENTS), 
	GANZ LINKSBUENDIG GESCHRIEBEN, DAMIT MAN ES SPÄTER SCHNELL SIEHT UND WEGMACHEN KANN */
	
	audio1.play();
</script>
</body>
</html>



